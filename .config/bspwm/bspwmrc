#!/bin/sh

# ---------------------------
# Helpers / Variables
# ---------------------------
WALLPAPER="$HOME/.config/feh/waves.png"

# Colors (dracula palette)
NORMAL_BORDER="#44475a"
ACTIVE_BORDER="#bd93f9"
FOCUSED_BORDER="#ff79c6"
PRESEL_COLOR="#6272a4"

# Rules: floating windows with size
declare -A FLOATING_RULES=(
    [nmtui]="800x600"
    [bluetooth]="800x600"
    [pulseaudio]="800x600"
    [yazi]="1600x1200"
)

# ---------------------------
# Utilities
# ---------------------------
# Start if not already running
start_if_needed() {
    pgrep -x "$1" > /dev/null || "$@" &
}

# Apply floating rules
apply_floating_rules() {
    for class in "${!FLOATING_RULES[@]}"; do
        bspc rule -a "$class" state=floating rectangle="${FLOATING_RULES[$class]}"
    done
}

# ---------------------------
# Screen Locking
# ---------------------------
xset s off  # Disable X11 screensaver (xidlehook handles idle detection)
xset +dpms
xset dpms 660 900 1200  # standby/suspend/off (in seconds, after 11/15/20 min)

# ---------------------------
# Input & Cursor
# ---------------------------
~/.config/bspwm/scripts/init-input.sh


# ---------------------------
# Monitor / Desktops
# ---------------------------
~/.config/bspwm/scripts/monitors.sh

# ---------------------------
# Defaults sanitation
# ---------------------------
~/.config/bspwm/scripts/defaults.sh

# ---------------------------
# BSPWM Settings
# ---------------------------
bspc config border_width         2
bspc config window_gap          12
bspc config split_ratio         0.52
bspc config borderless_monocle  true
bspc config gapless_monocle     true
bspc config normal_border_color "$NORMAL_BORDER"
bspc config active_border_color "$ACTIVE_BORDER"
bspc config focused_border_color "$FOCUSED_BORDER"
bspc config presel_feedback_color "$PRESEL_COLOR"
bspc config focus_follows_pointer true

# ---------------------------
# Startup Applications
# ---------------------------
start_if_needed sxhkd
start_if_needed picom
start_if_needed feh --bg-fill "$WALLPAPER"
start_if_needed xidlehook \
    --not-when-fullscreen \
    --not-when-audio \
    --timer 600 \
        ~/.local/bin/lockscreen \
        ''
"$HOME/.config/polybar/launch.sh"


# ---------------------------
# Floating Rules
# ---------------------------
apply_floating_rules
